<html>
<head>
        <meta charset="UTF-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
        <meta name="viewport" content="width=device-width, user-scalable=no,initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0">
        <link rel="stylesheet" href= "asset/style/index.css"></link>
        <link rel="stylesheet" href= "asset/style/MediaQuery.css"></link>
        <link rel="stylesheet" href="asset/mini-stock-v1.0/style.css">
         <link rel="icon" type="image/png" href="asset/image/Logo-MiniStock.png">
  
        <title>Admin System MiniStock</title>
</head>
<style type="text/css">
    
    *{
        margin: 0px;
        padding: 0px;
    }
body{
 display: flex;

}   
.containner-main {
    background: #2e374e;
    width: 100%;
}

.containner-section1 {
    background: linear-gradient(45deg, #000000, #03237cf2);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
}
.containner {
    display: grid;
    grid-template-columns: 1fr;
    grid-template-rows: 1.5fr 80px 1fr;
    grid-column-gap: 0px;
    grid-row-gap: 0px;
}
.containner-qrcodeuno{ grid-area: 1 / 1 / 2 / 2; }
.containner-btn { grid-area: 2 / 1 / 3 / 2; }
.texttarea{ grid-area: 3 / 1 / 4 / 2; }

.containner {
     align-items: center;
    background: red;
    height: 99vh;
}
.containner-qrcodeuno {
    grid-area: 1 / 1 / 2 / 2;
    background: black;
    height: 100%;
}

#qrcodeuno {
    width: 98%;
    height: 96%;
    background:linear-gradient(40deg, #2c528b, #d96b6b00);
    display: flex;
    justify-content: center;
    padding: 10px;
}

.texttarea {
    width: auto;
    height: 100%;
    padding: 5px;
    font-size: 18px;
}

.containner-btn {
    grid-area: 2 / 1 / 3 / 2;
    display: flex;
    align-items: center;
    flex-direction: column;
    background: blue;
    height: -webkit-fill-available;
}

.select_empresa {
    width: 100%;
    height: 50px;
    font-size: 20px;
    padding: 3px;
}

.btnGenerateCode {
    width: 100%;
    height: inherit;
    background: linear-gradient(45deg, #5c8b00, #b12323eb);
    color: white;
    font-weight: bold;
    font-size: 25px;
}
</style>
<body class="body">
        <main class="containner-main">
                <section class="containner-section1" id="containner_section1">
                    <img src="asset/image/logo.png" class="image-section1" onclick="Login()">
                </section>
                <section class="containner-section2 oculto"  id="containner_section2">
                    <section class="containner">
                            <div class="containner-qrcodeuno">
                                <div id="qrcodeuno"></div>
                            </div>
                            <div class="containner-btn">
                                <select class="select_empresa" id="select_empresa">
                                    <option select>MiniStock</option>
                                    <option>Advizualizer</option>
                                </select>
                                <button class="btnGenerateCode"onclick="GenerateCode()">Generar</button>
                            </div>
                            <textarea class="texttarea" id="data-secripter"> </textarea> 
                    </section>
                </section>
        </main>
</body>
<script src="asset/js/jspdf.js"></script>
<script src="asset/js/html5-qrcode.min.js"></script>
<script src="asset/js/qrcode.js"></script>
<script src="asset/js/html2canvas.js"></script>
<script src="asset/js/cryptojs.js"></script>
<script >


function Login(){

    var numero = prompt("Ingrese Contraseña:");

    if(numero==="1596321"){
            cammbio_area()
    }
    else{
        console.error("error")
    }

}


function cammbio_area(){
    
    document.getElementById("containner_section1").classList.replace('containner-section1','oculto');
    document.getElementById("containner_section2").classList.replace('oculto', 'containner-data-form');
}

/*---------------------------------------------*/

function GenerateCode(){

    document.getElementById("qrcodeuno").innerHTML=''

    let fecha = new Date();
    let ano = fecha.getFullYear();
    let diaTexto = fecha.toLocaleDateString();

    //console.log(document.getElementById("select_empresa").value);
    let NameApp = document.getElementById("select_empresa").value;

    let message = NameApp+diaTexto+"=";
    const password = "123647859"+NameApp;

    // Encriptar mensaje
    const encryptedMessage = CryptoJS.AES.encrypt(message, password).toString();

    console.log("Mensaje encriptado:", encryptedMessage);

    let code=[encryptedMessage,generarCodigoContrato()];

    let qrdata=code;

    var qrcode = new QRCode("qrcodeuno", {
            text: JSON.stringify(qrdata),
            width: 200,
            height: 200,
            colorDark: "black",
            colorLight: "white",
            correctLevel : QRCode.CorrectLevel.H
    });


/*--------------------------------------------*/
    const bytes = CryptoJS.AES.decrypt(encryptedMessage, password);
    const decryptedMessage = bytes.toString(CryptoJS.enc.Utf8);

    console.log(decryptedMessage)

document.getElementById("data-secripter").value=decryptedMessage


}



function generarCodigoContrato(){

          const fecha = new Date();
          
          // Obtener los componentes de la fecha
          const año = fecha.getFullYear();
          const mes = fecha.getMonth() + 1; // Los meses en JavaScript comienzan desde 0
          const dia = fecha.getDate();
          
          // Generar un número aleatorio de 4 dígitos
          const numeroAleatorio = Math.floor(Math.random() * 10000);
          
          // Crear el código de contrato combinando los componentes de la fecha y el número aleatorio
          const codigoContrato = `${año}${mes}${dia}${numeroAleatorio}`;
          
          return codigoContrato;
}



function descargar_qr(){

    let nombreEmpresa = document.getElementById("nombreEmpresa").value
    var fecha = new Date();
    var diaTexto = fecha.toLocaleDateString();

    html2canvas(document.getElementById("qr")).then(function(canvas) {
          
            var img = canvas.toDataURL("image/png");
            var link = document.createElement('a');
            link.href = img;
            link.download = "Qrcode"+"_"+nombreEmpresa+"_"+diaTexto+".png";
            link.click();
    });


}

</script>
</html>